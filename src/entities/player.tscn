[gd_scene format=3 uid="uid://bum3w3ougalos"]

[ext_resource type="PackedScene" uid="uid://blcdujkt26nhf" path="res://assets/main_character/main_character.glb" id="1_cusn3"]

[sub_resource type="GDScript" id="GDScript_26beo"]
script/source = "extends CharacterBody3D

const SPEED := 5.0
const JUMP_VELOCITY := 4.5
const WALK_BLEND_SPEED := 0.05

var idle_time := 0.0
var walk_blend_position := Vector2(0, 0)
var max_life : int = 5
var current_life : int = max_life

func _process(delta: float) -> void:
	var input_dir := Input.get_vector(\"left\", \"right\", \"up\", \"down\")
	walk_blend_position.x = move_toward(walk_blend_position.x, input_dir.x, WALK_BLEND_SPEED)
	walk_blend_position.y = move_toward(walk_blend_position.y, input_dir.y, WALK_BLEND_SPEED)
	$AnimationTree.set(\"parameters/WalkBlendSpace2D/blend_position\", walk_blend_position)

	if not velocity:
		idle_time += delta
	else:
		idle_time = 0

func _physics_process(delta: float) -> void:
	# Add the gravity.
	if not is_on_floor():
		velocity += get_gravity() * delta

	# Handle jump.
	if Input.is_action_just_pressed(\"ui_accept\") and is_on_floor():
		velocity.y = JUMP_VELOCITY

	# Get the input direction and handle the movement/deceleration.
	# As good practice, you should replace UI actions with custom gameplay actions.
	var input_dir := Input.get_vector(\"left\", \"right\", \"up\", \"down\")
	var direction := (transform.basis * Vector3(input_dir.x, 0, input_dir.y)).normalized()
	if direction:
		velocity.x = direction.x * SPEED
		velocity.z = direction.z * SPEED
	else:
		velocity.x = move_toward(velocity.x, 0, SPEED)
		velocity.z = move_toward(velocity.z, 0, SPEED)

	move_and_slide()

func _input(event: InputEvent) -> void:
	if event.is_action_pressed(\"ui_cancel\"):
		remove_life()
	if event.is_action_pressed(\"ui_select\"):
		add_life()

func remove_life() -> void:
	if current_life > 0:
		current_life = current_life - 1
		$MainCharacter/Armature/Skeleton3D/LeftHandBoneAttachment/Torch.light_energy = current_life / float(max_life)

func add_life() -> void:
	if current_life < max_life:
		current_life = current_life + 1
		$MainCharacter/Armature/Skeleton3D/LeftHandBoneAttachment/Torch.light_energy = current_life / float(max_life)
"

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_26beo"]
height = 4.1674805

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_2lfla"]
animation = &"marche_arriere"
use_custom_timeline = true
timeline_length = 1.133
stretch_time_scale = true
start_offset = 0.6000000000000014
loop_mode = 1

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_o5qvw"]
animation = &"marche_devant"
use_custom_timeline = true
timeline_length = 1.133
stretch_time_scale = true
start_offset = 0.0
loop_mode = 1

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_s0nk1"]
animation = &"marche_left"
use_custom_timeline = true
timeline_length = 1.133
stretch_time_scale = true
start_offset = 0.0
loop_mode = 1

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_lqcqj"]
animation = &"marche_droite"
use_custom_timeline = true
timeline_length = 1.133
stretch_time_scale = true
start_offset = 0.0
loop_mode = 1

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_ms0oa"]
animation = &"idle"

[sub_resource type="AnimationNodeBlendSpace2D" id="AnimationNodeBlendSpace2D_2lfla"]
blend_point_0/node = SubResource("AnimationNodeAnimation_2lfla")
blend_point_0/pos = Vector2(0, 1)
blend_point_1/node = SubResource("AnimationNodeAnimation_o5qvw")
blend_point_1/pos = Vector2(0, -1)
blend_point_2/node = SubResource("AnimationNodeAnimation_s0nk1")
blend_point_2/pos = Vector2(-1, 0)
blend_point_3/node = SubResource("AnimationNodeAnimation_lqcqj")
blend_point_3/pos = Vector2(1, 0)
blend_point_4/node = SubResource("AnimationNodeAnimation_ms0oa")
blend_point_4/pos = Vector2(0, 0)
sync = true

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_gkg86"]
animation = &"idle2"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_u2j08"]
animation = &"idle"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_3glep"]
animation = &"sortir_torche"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_o5qvw"]
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_lqcqj"]
xfade_time = 0.1
switch_mode = 2
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_2lfla"]
xfade_time = 0.1
advance_mode = 2
advance_expression = "idle_time == 0"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_3glep"]
xfade_time = 0.1
advance_mode = 2
advance_expression = "idle_time >= 5"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_gkg86"]
xfade_time = 0.1
break_loop_at_end = true
priority = 2
switch_mode = 2
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_rqrib"]
xfade_time = 0.1
priority = 2
switch_mode = 2
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_s0nk1"]
xfade_time = 0.1
advance_mode = 2
advance_expression = "idle_time == 0"

[sub_resource type="AnimationNodeStateMachine" id="AnimationNodeStateMachine_2lfla"]
states/Start/position = Vector2(167.5, 94.5)
states/WalkBlendSpace2D/node = SubResource("AnimationNodeBlendSpace2D_2lfla")
states/WalkBlendSpace2D/position = Vector2(606.5, 87.21875)
states/idle/node = SubResource("AnimationNodeAnimation_u2j08")
states/idle/position = Vector2(476.5, 212.5)
"states/idle 2/node" = SubResource("AnimationNodeAnimation_gkg86")
"states/idle 2/position" = Vector2(646, 217.5)
states/sortir_torche/node = SubResource("AnimationNodeAnimation_3glep")
states/sortir_torche/position = Vector2(332.5, 87.5)
transitions = ["Start", "sortir_torche", SubResource("AnimationNodeStateMachineTransition_o5qvw"), "sortir_torche", "WalkBlendSpace2D", SubResource("AnimationNodeStateMachineTransition_lqcqj"), "idle 2", "WalkBlendSpace2D", SubResource("AnimationNodeStateMachineTransition_2lfla"), "WalkBlendSpace2D", "idle 2", SubResource("AnimationNodeStateMachineTransition_3glep"), "idle", "idle 2", SubResource("AnimationNodeStateMachineTransition_gkg86"), "idle 2", "idle", SubResource("AnimationNodeStateMachineTransition_rqrib"), "idle", "WalkBlendSpace2D", SubResource("AnimationNodeStateMachineTransition_s0nk1")]
graph_offset = Vector2(95.96997, 7.0431876)

[node name="Player" type="CharacterBody3D" unique_id=460088547]
script = SubResource("GDScript_26beo")

[node name="CollisionShape3D" type="CollisionShape3D" parent="." unique_id=297260006]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 2.0837402, 0)
shape = SubResource("CapsuleShape3D_26beo")

[node name="MainCharacter" parent="." unique_id=805796366 instance=ExtResource("1_cusn3")]
transform = Transform3D(-1, 0, -8.742278e-08, 0, 1, 0, 8.742278e-08, 0, -1, 0, 0, 0)

bones/4/position = Vector3(6.67572e-06, 29.12155, 1.2562681e-05)
bones/4/rotation = Quaternion(-0.03131993, 0.14985588, -0.05484317, 0.98668873)
bones/5/position = Vector3(1.4305115e-06, 33.540718, -0.30647784)
bones/5/rotation = Quaternion(-0.05380709, 0.11214588, -0.023336977, 0.99195945)
bones/6/position = Vector3(1.7881393e-07, 76.44837, -0.6985529)
bones/7/position = Vector3(10.745476, 26.459852, -0.02640345)
bones/7/rotation = Quaternion(-0.5922269, -0.40666175, 0.5164391, -0.4660304)
bones/8/position = Vector3(4.4699652e-07, 22.018236, 1.8472758e-05)
bones/8/rotation = Quaternion(0.23483796, -0.3913969, 0.20866528, 0.8649383)
bones/9/position = Vector3(2.462791e-05, 59.046375, -2.5344623e-05)
bones/9/rotation = Quaternion(-0.035936538, 0.021642432, 0.54009557, 0.8405575)
bones/10/position = Vector3(-2.722588e-05, 52.63069, 2.0556068e-05)
bones/10/rotation = Quaternion(0.015947698, -0.305127, -0.102979206, 0.94659317)
bones/11/position = Vector3(-8.431525, 7.1248555, -1.3235979e-05)
bones/11/rotation = Quaternion(0.27054274, 0.22973152, 0.2185753, 0.9089857)
bones/12/position = Vector3(-2.1539516, 8.5643835, -1.2560372e-06)
bones/12/rotation = Quaternion(0.033891123, 0.021247922, -0.11090852, 0.99302536)
bones/13/position = Vector3(0.4728415, 8.947642, -2.874338e-05)
bones/13/rotation = Quaternion(0.10662207, -0.053028643, -0.35264337, 0.92815)
bones/14/position = Vector3(1.6810491, 6.3148417, -1.4747163e-05)
bones/15/position = Vector3(9.4146104e-05, 15.680079, -2.3700883e-05)
bones/15/rotation = Quaternion(0.46107212, 0.10081229, 0.049864024, 0.88020617)
bones/16/position = Vector3(0.33030725, 16.339539, 3.4438068e-05)
bones/16/rotation = Quaternion(0.5281328, -0.006151571, 0.103952415, 0.8427526)
bones/17/position = Vector3(-0.063271984, 9.598887, 2.3677221e-06)
bones/17/rotation = Quaternion(0.47432178, 0.013722204, 0.077620134, 0.8768156)
bones/18/position = Vector3(-0.26705357, 9.334155, 3.225574e-06)
bones/19/position = Vector3(-10.74546, 26.460619, -0.06979174)
bones/19/rotation = Quaternion(0.63468796, -0.39961854, 0.527851, 0.3985595)
bones/20/position = Vector3(-1.6433048e-06, 22.018215, -5.4073116e-06)
bones/20/rotation = Quaternion(0.41011634, -0.007397135, 0.012593949, 0.91191626)
bones/21/position = Vector3(3.6858025e-06, 59.043495, 8.3487175e-06)
bones/21/rotation = Quaternion(-0.015320575, -0.09811784, -0.16574739, 0.98115546)
bones/22/position = Vector3(-2.8628986e-06, 52.628662, 1.4583402e-05)
bones/22/rotation = Quaternion(0.056447938, -0.1659692, -0.08150008, 0.98113483)
bones/23/position = Vector3(9.215039, 7.4555016, -4.693866e-06)
bones/23/rotation = Quaternion(0.010840814, -0.23563601, -0.06582194, 0.96954924)
bones/24/position = Vector3(2.4363356, 9.164344, 8.551055e-06)
bones/24/rotation = Quaternion(0.1432302, 0.17009951, 0.079439454, 0.9717206)
bones/25/position = Vector3(-0.20267487, 8.393695, -2.0338134e-06)
bones/25/rotation = Quaternion(-0.00817192, 0.07908326, -0.12568408, 0.9888795)
bones/26/position = Vector3(-2.2336442, 5.779323, 2.6538164e-06)
bones/27/position = Vector3(1.5426704e-06, 15.566087, -6.5592903e-06)
bones/27/rotation = Quaternion(0.13133855, -0.031518932, 0.014872984, 0.99072486)
bones/28/position = Vector3(0.12418842, 16.211409, -1.7571445e-05)
bones/28/rotation = Quaternion(0.19901255, 0.027044725, -0.078106865, 0.97650504)
bones/29/position = Vector3(-0.43836975, 10.393876, -4.8574943e-06)
bones/29/rotation = Quaternion(0.17058875, 0.02326614, 0.01729432, 0.9849158)
bones/30/position = Vector3(0.31417388, 9.158777, 8.3533305e-06)
bones/31/position = Vector3(15.116845, -10.79286, 0.21535318)
bones/31/rotation = Quaternion(0.17093016, 0.11856303, 0.97649205, -0.05647175)
bones/32/position = Vector3(4.3138098e-06, 118.65899, 3.5245987e-06)
bones/32/rotation = Quaternion(-0.14487527, -0.11881955, 0.0030329558, 0.9822851)
bones/33/position = Vector3(3.4888883e-06, 106.50387, -4.3328862e-07)
bones/33/rotation = Quaternion(0.45859048, 0.016300375, -0.045325648, 0.8873414)
bones/34/rotation = Quaternion(0.33267504, 0.00875544, -0.0045310333, 0.94299006)
bones/36/position = Vector3(-15.116845, -10.792818, -0.058137435)
bones/36/rotation = Quaternion(-0.020491445, 0.049436435, 0.99553746, 0.077726975)
bones/37/rotation = Quaternion(-0.10245067, -0.0855556, 0.019563599, 0.990859)
bones/38/rotation = Quaternion(0.4956074, 0.03020553, 0.049702723, 0.86659706)
bones/39/rotation = Quaternion(0.34642383, -0.00967429, 0.0041634287, 0.93801904)
bones/6/position = Vector3(2.0899307e-07, 76.44838, -0.69855124)
bones/7/position = Vector3(10.745474, 26.459845, -0.026408821)
bones/7/rotation = Quaternion(-0.6178293, -0.38028052, 0.4124983, -0.5509256)
bones/8/position = Vector3(-4.0486175e-06, 22.018225, 3.8878316e-05)
bones/9/rotation = Quaternion(-0.04108919, 0.10632341, 0.5969336, 0.794152)
bones/10/position = Vector3(-2.1498893e-06, 52.63069, 1.5424823e-05)
bones/10/rotation = Quaternion(-0.119806536, -0.32278457, -0.14617008, 0.9274109)
bones/11/position = Vector3(-8.4316225, 7.1248612, -9.904123e-06)
bones/11/rotation = Quaternion(0.27032322, 0.22962062, 0.21934938, 0.9088926)
bones/12/position = Vector3(-2.1539533, 8.564367, 1.3886502e-06)
bones/12/rotation = Quaternion(0.033747833, 0.021176215, -0.11034806, 0.9930942)
bones/13/rotation = Quaternion(0.10664575, -0.052968387, -0.35280204, 0.9280904)
bones/14/position = Vector3(1.6810522, 6.31485, -3.5089586e-05)
bones/15/position = Vector3(1.3174321e-05, 15.680063, -1.7996332e-05)
bones/15/rotation = Quaternion(0.45293978, 0.09639664, 0.0429216, 0.8852745)
bones/16/position = Vector3(0.3302776, 16.33954, 1.2722194e-05)
bones/16/rotation = Quaternion(0.5179207, -0.0061302073, 0.10136947, 0.8493791)
bones/17/position = Vector3(-0.06329491, 9.598868, -3.8628596e-06)
bones/17/rotation = Quaternion(0.46347052, 0.013348724, 0.0748229, 0.8828468)
bones/18/position = Vector3(-0.26699755, 9.334168, 3.814912e-06)
bones/19/position = Vector3(-10.745464, 26.460634, -0.06979478)
bones/19/rotation = Quaternion(0.61904526, -0.40454477, 0.5693637, 0.35909805)
bones/20/position = Vector3(6.988375e-06, 22.01824, 8.516851e-06)
bones/20/rotation = Quaternion(0.39614558, 0.07412048, 0.11461101, 0.90798634)
bones/21/position = Vector3(-1.2140969e-05, 59.043488, 9.1044785e-07)
bones/21/rotation = Quaternion(-0.01372147, -0.09789095, -0.22252062, 0.96990395)
bones/22/position = Vector3(-1.0335295e-06, 52.62867, 9.570665e-06)
bones/22/rotation = Quaternion(-0.041224524, -0.15513584, -0.067854166, 0.9846976)
bones/23/position = Vector3(9.215067, 7.4555187, 2.194548e-06)
bones/23/rotation = Quaternion(0.007933406, -0.23122248, -0.10423456, 0.9672686)
bones/24/position = Vector3(2.436335, 9.164347, 1.4812671e-05)
bones/24/rotation = Quaternion(0.12564743, 0.17417344, 0.048529297, 0.9754596)
bones/25/position = Vector3(-0.20267628, 8.393719, -4.9003797e-06)
bones/25/rotation = Quaternion(-0.022994211, 0.07666283, -0.1649266, 0.983053)
bones/26/position = Vector3(-2.2336557, 5.7793202, 7.718175e-06)
bones/27/position = Vector3(9.067664e-06, 15.566094, 1.3256085e-06)
bones/27/rotation = Quaternion(0.13871054, -0.026310561, -0.008646084, 0.9899457)
bones/28/position = Vector3(0.12418437, 16.211374, -1.9160052e-05)
bones/28/rotation = Quaternion(0.21538939, 0.028022042, -0.084642075, 0.9724495)
bones/29/position = Vector3(-0.43836838, 10.393847, 2.9323187e-06)
bones/29/rotation = Quaternion(0.1871261, 0.024496336, 0.01048871, 0.9819744)
bones/30/position = Vector3(0.3141714, 9.158809, 7.402268e-07)
bones/31/position = Vector3(15.116842, -10.792843, 0.21535344)
bones/31/rotation = Quaternion(0.15264331, 0.14811619, 0.9750128, 0.06412286)
bones/32/position = Vector3(7.5065295e-06, 118.65897, 2.483704e-06)
bones/32/rotation = Quaternion(-0.41714218, -0.122367196, -0.005400799, 0.90054965)
bones/33/position = Vector3(2.0561406e-06, 106.503845, -1.4202758e-06)
bones/33/rotation = Quaternion(0.6167447, 0.08586916, 0.027962836, 0.7819659)
bones/34/rotation = Quaternion(0.42395866, 0.013809722, -0.0010508663, 0.9055757)
bones/36/position = Vector3(-15.116843, -10.792827, -0.058134295)
bones/36/rotation = Quaternion(-0.031690467, 0.24241441, 0.96964824, 0.00365768)
bones/37/rotation = Quaternion(-0.445739, -0.045888964, 0.024223197, 0.89365786)
bones/38/rotation = Quaternion(0.49575344, -0.024202669, -0.032806236, 0.86750597)
bones/39/rotation = Quaternion(0.38232097, 0.028959248, 0.01133071, 0.92350614)

[node name="LeftHandBoneAttachment" type="BoneAttachment3D" parent="MainCharacter/Armature/Skeleton3D" index="0" unique_id=186672180]
transform = Transform3D(0.12877226, 0.015368536, -0.9915548, 0.5291506, 0.84457487, 0.08181089, 0.8386998, -0.5352173, 0.100625634, 38.998657, 109.6066, -340.06702)
bone_name = "mixamorig_LeftHand"
bone_idx = 10

[node name="Node3D" parent="MainCharacter/Armature/Skeleton3D/LeftHandBoneAttachment" unique_id=1387670597 instance=ExtResource("2_3glep")]
transform = Transform3D(-13.377209, -97.05553, -20.031775, -11.513531, 21.598661, -96.95841, 98.4302, -10.663887, -14.063747, 24.1465, 10.4375, 16.318325)

[node name="Torch" type="OmniLight3D" parent="MainCharacter/Armature/Skeleton3D/LeftHandBoneAttachment" unique_id=225046883]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -100, 30, 20)
light_color = Color(0.9999997, 0.7524437, 0.66248655, 1)
shadow_enabled = true
shadow_transmittance_bias = 16.0
shadow_opacity = 0.8
omni_range = 8.0

[node name="Dialog" type="Label3D" parent="." unique_id=471950260]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 5, 0)
billboard = 1
text = "Hello
Je oeuf"
vertical_alignment = 2

[node name="AnimationTree" type="AnimationTree" parent="." unique_id=771295286]
root_node = NodePath("../MainCharacter")
tree_root = SubResource("AnimationNodeStateMachine_2lfla")
advance_expression_base_node = NodePath("..")
anim_player = NodePath("../MainCharacter/AnimationPlayer")

[editable path="MainCharacter"]
