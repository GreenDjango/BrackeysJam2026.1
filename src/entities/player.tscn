[gd_scene format=3 uid="uid://bum3w3ougalos"]

[ext_resource type="PackedScene" uid="uid://blcdujkt26nhf" path="res://assets/main_character/main_character.glb" id="1_cusn3"]

[sub_resource type="GDScript" id="GDScript_26beo"]
script/source = "extends CharacterBody3D

const SPEED := 5.0
const JUMP_VELOCITY := 4.5
const WALK_BLEND_SPEED := 0.1

var walk_blend_position := Vector2(0, 0)
var max_life : int = 5
var current_life : int = max_life

func _process(_delta: float) -> void:
	var input_dir := Input.get_vector(\"ui_left\", \"ui_right\", \"ui_up\", \"ui_down\")
	walk_blend_position.x = move_toward(walk_blend_position.x, input_dir.x, WALK_BLEND_SPEED)
	walk_blend_position.y = move_toward(walk_blend_position.y, input_dir.y, WALK_BLEND_SPEED)

	$AnimationTree.set(\"parameters/WalkBlendSpace2D/blend_position\", walk_blend_position)

func _physics_process(delta: float) -> void:
	# Add the gravity.
	if not is_on_floor():
		velocity += get_gravity() * delta

	# Handle jump.
	if Input.is_action_just_pressed(\"ui_accept\") and is_on_floor():
		velocity.y = JUMP_VELOCITY

	# Get the input direction and handle the movement/deceleration.
	# As good practice, you should replace UI actions with custom gameplay actions.
	var input_dir := Input.get_vector(\"ui_left\", \"ui_right\", \"ui_up\", \"ui_down\")
	var direction := (transform.basis * Vector3(input_dir.x, 0, input_dir.y)).normalized()
	if direction:
		velocity.x = direction.x * SPEED
		velocity.z = direction.z * SPEED
	else:
		velocity.x = move_toward(velocity.x, 0, SPEED)
		velocity.z = move_toward(velocity.z, 0, SPEED)

	move_and_slide()

func _input(event: InputEvent) -> void:
	if event.is_action_pressed(\"ui_cancel\"):
		remove_life()

func remove_life() -> void:
	if current_life > 0:
		current_life = current_life - 1
		$MainCharacter/Armature/Skeleton3D/LeftHandBoneAttachment/Torch.light_energy = current_life / float(max_life)
"

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_26beo"]
height = 4.1674805

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_cusn3"]
animation = &"marche_devant"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_v4rts"]
animation = &"marche_droite"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_hwyk6"]
animation = &"marche_left"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_l2v1k"]
animation = &"marche_arriere"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_2lfla"]
animation = &"idle"

[sub_resource type="AnimationNodeBlendSpace2D" id="AnimationNodeBlendSpace2D_ya6j6"]
blend_point_0/node = SubResource("AnimationNodeAnimation_cusn3")
blend_point_0/pos = Vector2(0, 1)
blend_point_1/node = SubResource("AnimationNodeAnimation_v4rts")
blend_point_1/pos = Vector2(1, 0)
blend_point_2/node = SubResource("AnimationNodeAnimation_hwyk6")
blend_point_2/pos = Vector2(-1, 0)
blend_point_3/node = SubResource("AnimationNodeAnimation_l2v1k")
blend_point_3/pos = Vector2(0, -1)
blend_point_4/node = SubResource("AnimationNodeAnimation_2lfla")
blend_point_4/pos = Vector2(0, 0)
sync = true

[sub_resource type="AnimationNodeBlendTree" id="AnimationNodeBlendTree_0qy4j"]
graph_offset = Vector2(0, 32)
nodes/output/position = Vector2(700, 200)
nodes/WalkBlendSpace2D/node = SubResource("AnimationNodeBlendSpace2D_ya6j6")
nodes/WalkBlendSpace2D/position = Vector2(280, 120)
node_connections = [&"output", 0, &"WalkBlendSpace2D"]

[node name="Player" type="CharacterBody3D" unique_id=460088547]
script = SubResource("GDScript_26beo")

[node name="CollisionShape3D" type="CollisionShape3D" parent="." unique_id=297260006]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 2.0837402, 0)
shape = SubResource("CapsuleShape3D_26beo")

[node name="MainCharacter" parent="." unique_id=805796366 instance=ExtResource("1_cusn3")]
transform = Transform3D(-1, 0, -8.742278e-08, 0, 1, 0, 8.742278e-08, 0, -1, 0, 0, 0)

[node name="Skeleton3D" parent="MainCharacter/Armature" parent_id_path=PackedInt32Array(805796366, 1566124132) index="0" unique_id=2084913571]
bones/0/position = Vector3(1.9367658, -3.129304, -260.39554)
bones/0/rotation = Quaternion(-0.67152786, -0.18282658, 0.18118855, 0.6948348)
bones/1/position = Vector3(8.34465e-07, 19.411194, -0.35083914)
bones/1/rotation = Quaternion(0.032513425, 0.0009141954, -0.027295118, 0.9990982)
bones/2/position = Vector3(-5.066395e-07, 22.65011, 1.0132791e-06)
bones/2/rotation = Quaternion(0.01072611, -0.0074813506, 0.027552925, 0.9995348)
bones/3/position = Vector3(-1.013279e-06, 25.88585, 1.4901161e-06)
bones/3/rotation = Quaternion(0.0113788815, -0.0043873116, 0.028168013, 0.9995289)
bones/4/position = Vector3(6.67572e-06, 29.12155, 1.2562681e-05)
bones/4/rotation = Quaternion(0.0016210957, 0.151519, -0.054686237, 0.9869392)
bones/5/position = Vector3(1.4305115e-06, 33.540718, -0.30647784)
bones/5/rotation = Quaternion(-0.04969358, 0.11466078, -0.010244252, 0.9921081)
bones/6/position = Vector3(1.7881393e-07, 76.44837, -0.6985529)
bones/7/position = Vector3(10.745476, 26.459852, -0.02640345)
bones/7/rotation = Quaternion(-0.5923922, -0.40514055, 0.5208896, -0.46217594)
bones/8/position = Vector3(4.4699652e-07, 22.018236, 1.8472758e-05)
bones/8/rotation = Quaternion(0.226072, -0.37010074, 0.20142542, 0.87826234)
bones/9/position = Vector3(2.462791e-05, 59.046375, -2.5344623e-05)
bones/9/rotation = Quaternion(-0.038436987, 0.023519685, 0.5503972, 0.83368605)
bones/10/position = Vector3(-2.722588e-05, 52.63069, 2.0556068e-05)
bones/10/rotation = Quaternion(0.009254116, -0.30560583, -0.078924134, 0.9488364)
bones/11/position = Vector3(-8.431525, 7.1248555, -1.3235979e-05)
bones/11/rotation = Quaternion(0.27054274, 0.22973152, 0.2185753, 0.9089857)
bones/12/position = Vector3(-2.1539516, 8.5643835, -1.2560372e-06)
bones/12/rotation = Quaternion(0.033891123, 0.021247922, -0.11090852, 0.99302536)
bones/13/position = Vector3(0.4728415, 8.947642, -2.874338e-05)
bones/13/rotation = Quaternion(0.10662207, -0.053028643, -0.35264337, 0.92815)
bones/14/position = Vector3(1.6810491, 6.3148417, -1.4747163e-05)
bones/15/position = Vector3(9.4146104e-05, 15.680079, -2.3700883e-05)
bones/15/rotation = Quaternion(0.46107212, 0.10081229, 0.049864024, 0.88020617)
bones/16/position = Vector3(0.33030725, 16.339539, 3.4438068e-05)
bones/16/rotation = Quaternion(0.5281328, -0.006151571, 0.103952415, 0.8427526)
bones/17/position = Vector3(-0.063271984, 9.598887, 2.3677221e-06)
bones/17/rotation = Quaternion(0.47432178, 0.013722204, 0.077620134, 0.8768156)
bones/18/position = Vector3(-0.26705357, 9.334155, 3.225574e-06)
bones/19/position = Vector3(-10.74546, 26.460619, -0.06979174)
bones/19/rotation = Quaternion(0.62580603, -0.40787202, 0.5334338, 0.39680684)
bones/20/position = Vector3(-1.6433048e-06, 22.018215, -5.4073116e-06)
bones/20/rotation = Quaternion(0.38786462, 0.008553736, 0.024058668, 0.92136264)
bones/21/position = Vector3(3.6858025e-06, 59.043495, 8.3487175e-06)
bones/21/rotation = Quaternion(-0.01889111, -0.10476549, -0.16820782, 0.97998655)
bones/22/position = Vector3(-2.8628986e-06, 52.628662, 1.4583402e-05)
bones/22/rotation = Quaternion(0.028175516, -0.16524605, -0.05022709, 0.98456955)
bones/23/position = Vector3(9.215039, 7.4555016, -4.693866e-06)
bones/23/rotation = Quaternion(0.007841328, -0.23111683, -0.10394995, 0.96732515)
bones/24/position = Vector3(2.4363356, 9.164344, 8.551055e-06)
bones/24/rotation = Quaternion(0.12528509, 0.17399372, 0.044251684, 0.9757416)
bones/25/position = Vector3(-0.20267487, 8.393695, -2.0338134e-06)
bones/25/rotation = Quaternion(-0.020863663, 0.07663339, -0.15661067, 0.98446184)
bones/26/position = Vector3(-2.2336442, 5.779323, 2.6538164e-06)
bones/27/position = Vector3(1.5426704e-06, 15.566087, -6.5592903e-06)
bones/27/rotation = Quaternion(0.09063391, -0.03252042, 0.026723236, 0.9949944)
bones/28/position = Vector3(0.12418842, 16.211409, -1.7571445e-05)
bones/28/rotation = Quaternion(0.16177146, 0.026033502, -0.06394634, 0.98441005)
bones/29/position = Vector3(-0.43836975, 10.393876, -4.8574943e-06)
bones/29/rotation = Quaternion(0.13305967, 0.021773633, 0.031841736, 0.9903571)
bones/30/position = Vector3(0.31417388, 9.158777, 8.3533305e-06)
bones/31/position = Vector3(15.116845, -10.79286, 0.21535318)
bones/31/rotation = Quaternion(0.17111267, 0.11408526, 0.97656685, -0.063422315)
bones/32/position = Vector3(4.3138098e-06, 118.65899, 3.5245987e-06)
bones/32/rotation = Quaternion(-0.14866643, -0.12121769, 0.004014037, 0.9814217)
bones/33/position = Vector3(3.4888883e-06, 106.50387, -4.3328862e-07)
bones/33/rotation = Quaternion(0.46334833, 0.01386893, -0.049636602, 0.8846764)
bones/34/rotation = Quaternion(0.33267504, 0.00875544, -0.0045310333, 0.94299006)
bones/36/position = Vector3(-15.116845, -10.792818, -0.058137435)
bones/36/rotation = Quaternion(-0.021357242, 0.040338445, 0.99630076, 0.072811276)
bones/37/rotation = Quaternion(-0.09570123, -0.09028743, 0.019734228, 0.9911105)
bones/38/rotation = Quaternion(0.495782, 0.029636946, 0.04869818, 0.866574)
bones/39/rotation = Quaternion(0.34642383, -0.00967429, 0.0041634287, 0.93801904)

[node name="LeftHandBoneAttachment" type="BoneAttachment3D" parent="MainCharacter/Armature/Skeleton3D" index="0" unique_id=186672180]
transform = Transform3D(0.0056191683, -0.27029508, -0.96276104, 0.3118412, 0.9152393, -0.25513273, 0.9501177, -0.29879504, 0.08943209, 26.00539, 116.65805, -343.95654)
bone_name = "mixamorig_LeftHand"
bone_idx = 10

[node name="Torch" type="OmniLight3D" parent="MainCharacter/Armature/Skeleton3D/LeftHandBoneAttachment" unique_id=225046883]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -100, 30, 20)
light_color = Color(0.9999997, 0.7524437, 0.66248655, 1)
shadow_enabled = true
shadow_transmittance_bias = 16.0
shadow_opacity = 0.8
omni_range = 8.0

[node name="Dialog" type="Label3D" parent="." unique_id=471950260]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 5, 0)
billboard = 1
text = "Hello
Je oeuf"
vertical_alignment = 2

[node name="AnimationTree" type="AnimationTree" parent="." unique_id=771295286]
root_node = NodePath("../MainCharacter")
tree_root = SubResource("AnimationNodeBlendTree_0qy4j")
anim_player = NodePath("../MainCharacter/AnimationPlayer")
parameters/WalkBlendSpace2D/blend_position = Vector2(0, 0)

[editable path="MainCharacter"]
